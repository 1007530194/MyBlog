
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="niult" />
        <meta name="description" content="前提及说明 第一次遇见矩阵求导，大多数人都是一头雾水，而搜了维基百科看也还是云里雾里，一堆的名词和一堆的表格到底都是什么呢？这里总结了我个人的学习经验，并且通过一个例子可以让你感受如何进行矩阵求导，下次再遇到需要进行矩阵求导的地方就不会措手不及。 在进行概念的解说之前，首先大家需要先知道下面的这个前提： https://en.wikipedia.org/wiki/Matrix_calculus 基本分类 前提 若$x$为向量，则默认$\boldsymbol x$为列向量，$\boldsymbol x^T$为行向量 若 …" />


    <title>矩阵求导 - 魑魅魍魉</title>

        <link rel="stylesheet" href="../../../theme/css/bootstrap.min.css" type="text/css" />

    <link href="../../../theme/css/fontawesome-all.min.css" rel="stylesheet" />
    <link href="../../../theme/css/pygments/native.css" rel="stylesheet" />

    <link href="../../../theme/css/pelican-twitchy.min.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Feeds -->
</head>
<body data-spy="scroll" data-target="#scrollspy">
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-small" class="twitchy-background">
            <ul id="accordion-small" class="sidebar-nav sidebar-nav-small">
                <li>
        <a href="../../.." title="魑魅魍魉" class="collapsed">
            <span class="fas fa-home"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
        <a href="../../../archives.html" title="Recent Articles" class="collapsed">
            <span class="fas fa-th-list"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-social-small" title="Social" class="collapsed">
                        <i class="fas fa-users padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social-small" class="collapse ">
                    <li>
                        <a href="#" title="Another social link"><i class="fab fa-another-social-link-square padding-small"></i></a>
                    </li>
                    <li>
                        <a href="#" title="You can add links in your config file"><i class="fab fa-you-can-add-links-in-your-config-file-square padding-small"></i></a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
        <a href="#" title="Back to top" class="collapsed">
            <span class="fas fa-arrow-up"></span>
        </a>
    </li>
            </ul>
        </div>
        <div id="sidebar-wrapper" class="twitchy-background">
            <ul id="accordion" class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="../../../">
                            <span class="fas fa-home padding-small"></span>
                            魑魅魍魉
                    </a>
                </li>
                    <li>
                        <a href="../../../archives.html">
                            <span class="fas fa-th-list padding-small"></span>
                            Recent Articles
                        </a>
                    </li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-social">
                        <i class="fas fa-users padding-small"></i>
                        Contact
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social" class="sidebar_submenu collapse ">
                    <li>
                        <a href="#" title="Another social link">
                            <i class="fab fa-another-social-link-square padding-small"></i>
                            Another social link
                        </a>
                    </li>
                    <li>
                        <a href="#" title="You can add links in your config file">
                            <i class="fab fa-you-can-add-links-in-your-config-file-square padding-small"></i>
                            You can add links in your config file
                        </a>
                    </li>
                </ul></li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-pages">
                        <i class="fas fa-folder-open padding-small"></i>
                        Pages
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-pages" class="sidebar_submenu collapse ">
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-categories">
                        <i class="fas fa-folder-open padding-small"></i>
                        Categories
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-categories" class="sidebar_submenu collapse ">
                    <li >
                        <a href="../../../category/00qi-ta-2.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            00.其他2
                            <span class="badge badge-secondary float-right categorybadge">2</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/01chang-yong-gong-ju.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            01常用工具
                            <span class="badge badge-secondary float-right categorybadge">10</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/02gong-ju-shi-yong.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            02.工具使用
                            <span class="badge badge-secondary float-right categorybadge">2</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/02wo-ai-du-shu.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            02.我爱读书
                            <span class="badge badge-secondary float-right categorybadge">1</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/03chang-yong-ming-ling.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            03.常用命令
                            <span class="badge badge-secondary float-right categorybadge">3</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/03shen-du-xue-xi.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            03深度学习
                            <span class="badge badge-secondary float-right categorybadge">12</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="../../../category/ji-chu-zhi-shi.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            基础知识
                            <span class="badge badge-secondary float-right categorybadge">3</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/ji-qi-xue-xi-shi-zhan.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            机器学习实战
                            <span class="badge badge-secondary float-right categorybadge">18</span>
                        </a>
                    </li>
                    <li >
                        <a href="../../../category/shen-du-xue-xi.html">
                            <i class="fas fa-folder-open padding-small"></i>
                            深度学习
                            <span class="badge badge-secondary float-right categorybadge">1</span>
                        </a>
                    </li>
                </ul></li>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- open/close sidebar -->
        <a href="#menu-toggle" class="btn btn-primary" id="menu-toggle">
            <span id="right-arrow" class="fas fa-chevron-right"  title="expand sidebar"></span>
            <span id="left-arrow" class="fas fa-chevron-left" title="minimize sidebar"></span>
        </a>
       <!-- /open/close sidebar -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
<section id="content">
    <article>
        <div class="row">
            <div class="col-lg-9">
                <header class="page-header">
                    <h1>
                        <a href="../../../pages/2018/01/ju-zhen-qiu-dao.html"
                           rel="bookmark"
                           title="Permalink to 矩阵求导">
                            矩阵求导
                        </a>
                        <small>
<div class="post-info">
    <div class="publish-info-block">
        <small>
            <span class="published">
                <i class="fa fa-calendar padding-small"></i><time datetime="2018-01-01T00:00:00+08:00"> 2018-01-01 00:00</time>
            </span>
            <span class="category">
                <i class="fa fa-folder-open padding-small"></i><a href="../../../category/ji-chu-zhi-shi.html">基础知识</a>
            </span>
        </small>
    </div>
</div><!-- /.post-info -->                        </small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="entry-content">
                    <h1>前提及说明</h1>
<p>第一次遇见矩阵求导，大多数人都是一头雾水，而搜了维基百科看也还是云里雾里，一堆的名词和一堆的表格到底都是什么呢？这里总结了我个人的学习经验，并且通过一个例子可以让你感受如何进行矩阵求导，下次再遇到需要进行矩阵求导的地方就不会措手不及。</p>
<p>在进行概念的解说之前，首先大家需要先知道下面的这个前提：</p>
<p>https://en.wikipedia.org/wiki/Matrix_calculus</p>
<h1>基本分类</h1>
<h2>前提</h2>
<p>若$x$为向量，则默认$\boldsymbol x$为列向量，$\boldsymbol x^T$为行向量
若$y$为向量，则默认$\boldsymbol y$为列向量，$\boldsymbol y^T$为行向量</p>
<h2>标量/向量</h2>
<p>$$\frac {\partial y}{\partial\boldsymbol x}=
\begin{bmatrix} 
 \frac {\partial y}{\partial x_1}
\\frac {\partial y}{\partial x_2}
\ ...
\\frac {\partial y}{\partial x_n}
\end{bmatrix} $$</p>
<p>$$\frac {\partial y}{\partial\boldsymbol x^T}=
\left ({\frac {\partial y^T}{\partial\boldsymbol x}} \right)^T=
\left ({\frac {\partial y}{\partial\boldsymbol x}} \right)^T=
\begin{bmatrix} 
 \frac {\partial y}{\partial x_1}
&amp;\frac {\partial y}{\partial x_2}
&amp; ...
&amp;\frac {\partial y}{\partial x_n}
\end{bmatrix} 
$$</p>
<h2>向量/标量</h2>
<p>$$\frac {\partial\boldsymbol y}{\partial x}=
\begin{bmatrix} 
  \frac {\partial y_1}{\partial x}
\\frac {\partial y_2}{\partial x}
\ ...
\\frac {\partial y_n}{\partial x}
\end{bmatrix} $$</p>
<p>$$\frac {\partial\boldsymbol y^T}{\partial x}=
\left(\frac {\partial\boldsymbol y}{\partial x^T}\right)^T=
\left(\frac {\partial\boldsymbol y}{\partial x}\right)^T=
\begin{bmatrix} 
  \frac {\partial y_1}{\partial x}
&amp;\frac {\partial y_2}{\partial x}
&amp; ...
&amp;\frac {\partial y_n}{\partial x}
\end{bmatrix} 
$$</p>
<h2>向量/向量</h2>
<h3>1 $\frac {\partial\boldsymbol y^T}{\partial\boldsymbol x}$按照$\boldsymbol x$展开</h3>
<p>$$\frac {\partial\boldsymbol y^T}{\partial\boldsymbol x}
=\begin{bmatrix} 
 \frac {\partial\boldsymbol y^T}{\partial x_1}
\\frac {\partial\boldsymbol y^T}{\partial x_2}
\ ...
\\frac {\partial\boldsymbol y^T}{\partial x_n}
\end{bmatrix}
=\begin{bmatrix} 
  \frac {\partial y_1}{\partial x_1}
  &amp; \frac {\partial y_2}{\partial x_1}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_1}
\\frac {\partial y_1}{\partial x_2}
  &amp; \frac {\partial y_2}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_2}
\ ...
  &amp; ...
\\frac {\partial y_1}{\partial x_n}
  &amp; \frac {\partial y_2}{\partial x_n}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_n}
\end{bmatrix}
$$</p>
<h3>2 $\frac {\partial\boldsymbol y^T}{\partial\boldsymbol x}$按照$\boldsymbol y$展开</h3>
<p>$$\frac {\partial\boldsymbol y^T}{\partial\boldsymbol x}
=\begin{bmatrix} 
  \frac {\partial y_1}{\partial\boldsymbol x}
&amp;\frac {\partial y_2}{\partial\boldsymbol x}
&amp; ...
&amp;\frac {\partial y_m}{\partial\boldsymbol x}
\end{bmatrix}
=\begin{bmatrix} 
  \frac {\partial y_1}{\partial x_1}
  &amp; \frac {\partial y_2}{\partial x_1}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_1}
\\frac {\partial y_1}{\partial x_2}
  &amp; \frac {\partial y_2}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_2}
\ ...
  &amp; ...
\\frac {\partial y_1}{\partial x_n}
  &amp; \frac {\partial y_2}{\partial x_n}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_n}
\end{bmatrix} 
$$</p>
<h3>3 $\frac {\partial\boldsymbol y}{\partial\boldsymbol x^T}$按照$\boldsymbol x$展开</h3>
<p>$$\frac {\partial\boldsymbol y}{\partial\boldsymbol x^T}
=\begin{bmatrix} 
  \frac {\partial\boldsymbol y}{\partial x_1}
&amp;\frac {\partial\boldsymbol y}{\partial x_2}
&amp; ...
&amp;\frac {\partial\boldsymbol y}{\partial x_n}
\end{bmatrix}
=\begin{bmatrix} 
  \frac {\partial y_1}{\partial x_1}
  &amp; \frac {\partial y_1}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_1}{\partial x_n}
\\frac {\partial y_2}{\partial x_1}
  &amp; \frac {\partial y_2}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_2}{\partial x_n}
\ ...
  &amp; ...
\\frac {\partial y_m}{\partial x_1}
  &amp; \frac {\partial y_m}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_n}
\end{bmatrix} 
$$</p>
<h3>4 $\frac {\partial\boldsymbol y}{\partial\boldsymbol x^T}$按照$\boldsymbol y$展开</h3>
<p>$$\frac {\partial\boldsymbol y}{\partial\boldsymbol x^T}
=\begin{bmatrix} 
 \frac {\partial y_1}{\partial\boldsymbol x^T}
\\frac {\partial y_2}{\partial\boldsymbol x^T}
\ ...
\\frac {\partial y_m}{\partial\boldsymbol x^T}
\end{bmatrix}
=\begin{bmatrix} 
  \frac {\partial y_1}{\partial x_1}
  &amp; \frac {\partial y_1}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_1}{\partial x_n}
\\frac {\partial y_2}{\partial x_1}
  &amp; \frac {\partial y_2}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_2}{\partial x_n}
\ ...
  &amp; ...
\\frac {\partial y_m}{\partial x_1}
  &amp; \frac {\partial y_m}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_n}
\end{bmatrix} 
$$</p>
<h1>标量/矩阵</h1>
<p>$$\frac {\partial y}{\partial\boldsymbol X}
=\frac {\partial y}{\partial{
\begin{bmatrix} 
  \boldsymbol x_1^T
\\boldsymbol x_2^T
\ ...
\\boldsymbol x_p^T
\end{bmatrix}
}}
=\begin{bmatrix} 
  \frac {\partial y}{\boldsymbol x_1^T}
\\frac {\partial y}{\boldsymbol x_2^T}
\ ...
\\frac {\partial y}{\boldsymbol x_p^T}
\end{bmatrix}
=\begin{bmatrix} 
  \frac {\partial y}{\partial x_{11}}
  &amp; \frac {\partial y}{\partial x_{21}}
  &amp; ...
  &amp; \frac {\partial y}{\partial x_{p1}}
\\frac {\partial y}{\partial x_{12}}
  &amp; \frac {\partial y}{\partial x_{22}}
  &amp; ...
  &amp; \frac {\partial y}{\partial x_{p2}}
\ ...
  &amp; ...
\\frac {\partial y}{\partial x_{1q}}
  &amp; \frac {\partial y}{\partial x_{2q}}
  &amp; ...
  &amp; \frac {\partial y}{\partial x_{pq}}
\end{bmatrix} 
$$</p>
<h1>矩阵/标量</h1>
<p>$$\frac {\partial\boldsymbol Y}{\partial x}=
\begin{bmatrix} 
  \frac {\partial y_{11}}{\partial x}
  &amp; \frac {\partial y_{12}}{\partial x}
  &amp; ...
  &amp; \frac {\partial y_{1n}}{\partial x}
\\frac {\partial y_{21}}{\partial x}
  &amp; \frac {\partial y_{22}}{\partial x}
  &amp; ...
  &amp; \frac {\partial y_{2n}}{\partial x}
\ ...
  &amp; ...
\\frac {\partial y_{m1}}{\partial x}
  &amp; \frac {\partial y_{m2}}{\partial x}
  &amp; ...
  &amp; \frac {\partial y_{mn}}{\partial x}
\end{bmatrix} 
$$</p>
<h1>一个求导的例子</h1>
<p>问题</p>
<p>$$\frac {\partial {(y−Xw)^T(y−Xw)}}{\partial w}$$</p>
<p>说明： $y$、$w$为列向量，$X$为矩阵</p>
<h2>式子演化</h2>
<p>看到这个例子不要急着去查表求导，先看看它的形式，是$u(w)∗v(w)$的形式，这种形式一般求导较为复杂，因此为了简化运算，我们先把式子展开成下面的样子（注意：$(Xw)^T=w^TX^T$）： </p>
<p>$$\frac{\partial(y^Ty−y^TXw−w^TX^Ty+w^TX^TXw)}{\partial w}$$</p>
<p>然后就可以写成四个部分求导的形式如下（累加后求导=求导后累加）： </p>
<p>$$
\frac{\partial y^Ty}{\partial w}
−\frac{\partial y^TXw}{\partial w}
−\frac{\partial w^TX^Ty}{\partial w}
+\frac{\partial w^TX^TXw}{\partial w}
$$</p>
<h2>求导</h2>
<p>$\frac{\partial y^Ty}{\partial w}$求导 : </p>
<p>$$\frac{\partial y^Ty}{\partial w}=0$$</p>
<p>说明：分子部分为标量，分母部分为向量，找到维基百科中的Scalar-by-vector identities表格，在表格中匹配形式到第1行的位置，因为分母为列向量，因此为分母布局，对应的求导结果就是 0 。</p>
<p>$\frac{\partial y^TXw}{\partial w}$求导 : </p>
<p>$$\frac{\partial y^TXw}{\partial w}=X^Ty$$</p>
<p>说明：同样的，在维基百科中的Scalar-by-vector identities表格，在表格中匹配形式到第11行的位置，对应的求导结果就是 $X^Ty$ 。</p>
<p>$\frac{\partial w^TX^Ty}{\partial w}$求导 :</p>
<p>$$\frac{\partial w^TX^Ty}{\partial w}=\frac{\partial(w^TX^Ty)^T}{\partial w}=\frac{\partial y^TXw}{\partial w}=X^Ty$$</p>
<p>说明：因为分子为标量，标量的转置等于本身，所以对分子进行转置操作，其等价于第二部分。</p>
<p>$\frac{\partial w^TX^TXw}{\partial w}$求导 : </p>
<p>$$\frac{\partial w^TX^TXw}{\partial w}=2X^TXw$$</p>
<p>说明：同样的，在维基百科中的Scalar-by-vector identities表格，在表格中匹配形式到第13行的位置，矩阵的转置乘上本身（$X^TX$）为对称矩阵当做表格中的A ，所以得到求导结果 $2X^TXw$ 。</p>
<h2>整合</h2>
<p>把四个部分求导结果进行相应的加减就可以得到最终的结果： </p>
<p>$$\frac{\partial y^Ty}{\partial w}
−\frac{\partial y^TXw}{\partial w}
−\frac{\partial w^TX^Ty}{\partial w}
+\frac{\partial w^TX^TXw}{\partial w}
=0−X^Ty−X^Ty+2X^TXw=−2X^T(y+Xw)$$</p>
<p>现在你再看看维基百科里那成堆的表格，是不是觉得异常实用了！</p>
<p>$$\frac {\partial\boldsymbol y^T}{\partial\boldsymbol x}
=\begin{bmatrix} 
 \frac {\partial\boldsymbol y^T}{\partial x_1}
\\frac {\partial\boldsymbol y^T}{\partial x_2}
\ ...
\\frac {\partial\boldsymbol y^T}{\partial x_n}
\end{bmatrix}
=\begin{bmatrix} 
  \frac {\partial y_1}{\partial x_1}
  &amp; \frac {\partial y_2}{\partial x_1}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_1}
\\frac {\partial y_1}{\partial x_2}
  &amp; \frac {\partial y_2}{\partial x_2}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_2}
\ ...
  &amp; ...
\\frac {\partial y_1}{\partial x_n}
  &amp; \frac {\partial y_2}{\partial x_n}
  &amp; ...
  &amp; \frac {\partial y_m}{\partial x_n}
\end{bmatrix}
$$</p>
<p>$$\boldsymbol y=\boldsymbol A^T \boldsymbol x$$</p>
<p>$$\boldsymbol y=\boldsymbol A^T \boldsymbol x$$</p>
<p>$$\frac {\partial\boldsymbol y^T}{\partial\boldsymbol x}
=\frac {\partial\boldsymbol x^T \boldsymbol A}{\partial\boldsymbol x}
$$</p>
                </div>
                <footer class="text-right">
                    <p>- niult</p>
                </footer>
            </div>
        </div>
    </article>
</section>
<footer>
    <hr>
    <div class="row">
        <div class="col-lg-9 text-center">
            <p><small>
                Built by <a href="http://docs.getpelican.com/en/latest">Pelican</a> / <a href="https://github.com/ingwinlu/pelican-twitchy">pelican-twitchy</a>
                &middot;                    &copy; 2018 niult
            </small></p>
        </div>
    </div>
</footer>            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.2 -->
    <script src="../../../theme/js/jquery-1.11.2.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="../../../theme/js/bootstrap.min.js"></script>
    <!-- twitchy Script -->
    <script src="../../../theme/js/pelican_twitchy.min.js"></script>

</body>
</html>